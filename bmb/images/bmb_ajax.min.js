var userAgent=navigator.userAgent.toLowerCase();var browserId=userAgent.match(/(firefox|chrome|safari|opera|msie)/)[1];var browserVersion=(userAgent.match(new RegExp(".+(?:version)[/: ]([\\d.]+)"))||userAgent.match(new RegExp("(?:"+browserId+")[/: ]([\\d.]+)"))||[0,"0"])[1];var isIe6=(browserId+browserVersion=="msie6.0");var ajaxed=new Array();var ajaxinfo=new Array();var ajaxtmp=new Array();var tname=new Array();ajaxtmp.times=Date.parse(new Date());function makeRequest(b,d,a,c){http_request=false;if(!c){c="GET"}if(window.XMLHttpRequest){http_request=new XMLHttpRequest();if(http_request.overrideMimeType){http_request.overrideMimeType("text/xml")}}else{if(window.ActiveXObject){try{http_request=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{http_request=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}}}if(!http_request){alert("Cannot Create an XMLHttp request");return false}http_request.onreadystatechange=a;http_request.open(c,b,true);http_request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");http_request.send(d)}function alertContents(){if(http_request.readyState==4){if(http_request.status==200){alert(http_request.responseText)}else{display_error_box(http_request.responseText)}}}function bmb_ajax_modifytitle_back(){if(http_request.readyState==4){filename=ajaxtmp.filename;if(http_request.status==200){document.getElementById("t"+filename).innerHTML="<span id='t"+filename+"'><a id='forum' onfocus='this.blur()' href='"+filetopn+"?filename="+filename+"'>"+http_request.responseText+"</a></span>";tname[filename]=http_request.responseText}else{display_error_box(http_request.responseText)}ajaxed[filename]=0;ajaxtmp.filename=""}}function bmb_ajax_tabletitle(a,c,d,b){if(ajaxed[c]==1){document.getElementById("t"+c).innerHTML=ajaxinfo[c];ajaxed[c]=0}else{ajaxed[c]=1;ajaxinfo[c]=document.getElementById("t"+c).innerHTML;document.getElementById("t"+c).innerHTML="<input onkeydown='javascript: if((event.ctrlKey && event.keyCode==13) || (event.altKey && event.keyCode == 83)) { document.getElementById(\"s"+c+"\").click(); }' size='35' type='text' value='"+tname[c]+"' id='title"+c+"'>  <input onclick=\"ajaxtmp['filename']="+c+";this.disabled='disabled';makeRequest('plugins.php?p=ajax&act=modifytitle&filetopn="+b+"&filename="+c+"&newtitle='+bmb_ajax_encode(document.getElementById('title"+c+"').value),null,bmb_ajax_modifytitle_back,'');\" type='button' value='"+d+"' name='s"+c+"' id='sub"+c+"'>"}}function gotofloor(c,b,e,d,a){c=document.getElementById(c);if(c.value>=1&&(c.value-1)<=e){page=Math.floor((c.value-1)/d)+1;window.location="topic.php?filename="+b+"&page="+page+"#floor"+c.value}else{display_error_box(a)}}function ajax_gotofloor(c,b,e,a,d){c=document.getElementById(c);if(c.value>=1&&(c.value-1)<=e){page=Math.floor((c.value-1)/d)+1;bmb_ajax_displayfloor(c.value,b,page)}else{display_error_box(a)}}function bmb_ajax_displayfloor_back(){if(http_request.readyState==4){if(http_request.status==200){document.getElementById("posts").innerHTML=http_request.responseText;document.getElementById("multi_page_bar").innerHTML=ajaxtmp.oldinner}else{display_error_box(http_request.responseText)}}}function bmb_ajax_displayfloor(a,b,c){ajaxtmp.times=ajaxtmp.times+1;ajaxtmp.oldinner=document.getElementById("multi_page_bar").innerHTML;document.getElementById("multi_page_bar").innerHTML=exchanging;makeRequest("topic.php?ajax_display=1&rnd="+ajaxtmp.times+"&filename="+b+"&floor="+a,null,bmb_ajax_displayfloor_back,"GET");if(script_rewrite=="1"){document.getElementById("pageurladdress").value=script_pos+"/topic_"+b+"_"+c+"#floor"+a}else{document.getElementById("pageurladdress").value=script_pos+"/topic.php?filename="+b+"&page="+c+"#floor"+a}}function ajax_gotopages(c,b,a){if(c.keyCode==13){bmb_ajax_displaypost(b.value,a)}}function bmb_ajax_displaypost_back(){if(http_request.readyState==4){if(http_request.status==200){result=http_request.responseText.split('<div class="bmbajaxpagebar"></div>');document.getElementById("posts").innerHTML=result[0];if(ajaxtmp.nopagebarchange!=1){document.getElementById("multi_page_bar").innerHTML=result[1];document.getElementById("multi_page_bar_2").innerHTML=result[1]}else{document.getElementById("multi_page_bar").innerHTML="";ajaxtmp.nopagebarchange=0}}else{display_error_box(http_request.responseText)}}}function bmb_ajax_displaypost(a,b){ajaxtmp.times=ajaxtmp.times+1;document.getElementById("multi_page_bar").innerHTML=exchanging;makeRequest("topic.php?ajax_display=1&rnd="+ajaxtmp.times+"&filename="+b+"&page="+a,null,bmb_ajax_displaypost_back,"GET");if(script_rewrite=="1"){document.getElementById("pageurladdress").value=script_pos+"/topic_"+b+"_"+a}else{document.getElementById("pageurladdress").value=script_pos+"/topic.php?filename="+b+"&page="+a}}function bmb_ajax_replythread(a){document.getElementById("quicksubmit").disabled="disabled";submitstring="ajax_reply=1";for(i=0;i<a.elements.length;i++){var b=a.elements[i];if(b.name&&!b.disabled){if(b.type!="checkbox"){submitstring+="&"+b.name+"="+bmb_ajax_encode(b.value)}else{if(b.checked==1){submitstring+="&"+b.name+"="+bmb_ajax_encode(b.value)}}}}ajaxtmp.filename=a.filename.value;makeRequest("post.php",submitstring,bmb_ajax_display_ajax,"POST")}function bmb_ajax_display_ajax(){if(http_request.readyState==4){if(http_request.status==200){result=http_request.responseText;makeRequest("topic.php?ajax_display=1&pid="+result+"&filename="+ajaxtmp.filename+"&page=last",null,bmb_ajax_displaypost_reply_back,"GET");document.getElementById("resetform").click();clckcnt=0}else{document.getElementById("quicksubmit").disabled="";display_error_box(http_request.responseText);clckcnt=0}}}function bmb_ajax_displaypost_reply_back(){if(http_request.readyState==4){if(http_request.status==200){result=http_request.responseText;document.getElementById("posts").innerHTML+=result;document.getElementById("quicksubmit").disabled=""}else{clckcnt=0;document.getElementById("quicksubmit").disabled="";display_error_box(http_request.responseText)}}}function bmb_ajax_online_back(){if(http_request.readyState==4){if(http_request.status==200){document.body.style.cursor="";result=http_request.responseText;document.getElementById("onlinelist").innerHTML=result}else{document.body.style.cursor="";display_error_box(http_request.responseText)}}}function bmb_ajax_online(a){document.body.style.cursor="wait";makeRequest(a,null,bmb_ajax_online_back,"GET")}function bmb_ajax_preprocess(a,c,b){ajaxtmp.times=ajaxtmp.times+1;if(b==1){bmb_ajax_online(a+c+"ajax_online=1&rnd="+ajaxtmp.times+"&online_show="+online_show_anti)}else{window.location=a+c+"online_show="+online_show_anti+"#onlinearea"}if(online_show_anti=="show"){online_show_anti="hide"}else{online_show_anti="show"}}function bmb_ajax_modifycontent(a){document.body.style.cursor="wait";submitstring="ajax_content=1";submitstring="&newcontent="+bmb_ajax_encode(document.getElementById("c"+a).value);makeRequest("plugins.php?p=ajax&act=modifycontent&filename="+a,submitstring,bmb_ajax_modifycontent_back,"POST")}function bmb_ajax_modifycontent_back(){if(http_request.readyState==4){filename=ajaxtmp.filename;if(http_request.status==200){document.body.style.cursor="";document.getElementById("sub"+filename).disabled="";document.getElementById("text"+filename).innerHTML=http_request.responseText;ajaxed[filename]=0;ajaxtmp.filename=""}else{document.getElementById("sub"+filename).disabled="";ajaxtmp.times++;document.body.style.cursor="";display_error_box(http_request.responseText)}}}function bmb_ajax_getcontent(a){document.body.style.cursor="wait";makeRequest("plugins.php?p=ajax&times="+ajaxtmp.times+"&act=getcontent&filename="+a,null,bmb_ajax_getcontent_back,"GET")}function bmb_ajax_getcontent_back(){if(http_request.readyState==4){filename=ajaxtmp.filename;if(http_request.status==200){document.body.style.cursor="";document.getElementById("text"+filename).innerHTML="<textarea onkeydown='javascript: if((event.ctrlKey && event.keyCode==13) || (event.altKey && event.keyCode == 83)) { document.getElementById(\"sub"+filename+"\").click(); }' cols='90' rows='20' id='c"+filename+"'>"+http_request.responseText+"</textarea><br /><input onclick=\"this.disabled='disabled';bmb_ajax_modifycontent("+filename+");\" type='button' value='"+ajaxtmp.sublang+"' id='sub"+filename+"''>"}else{document.body.style.cursor="";display_error_box(http_request.responseText)}}}function bmb_ajax_tablecontent(a,b){if(ajaxed[a]==1){document.getElementById("text"+a).innerHTML=ajaxinfo[a];ajaxed[a]=0}else{ajaxed[a]=1;ajaxtmp.filename=a;ajaxtmp.times=ajaxtmp.times+1;ajaxtmp.sublang=b;ajaxinfo[a]=document.getElementById("text"+a).innerHTML;bmb_ajax_getcontent(a)}}function bmb_ajax_makepoll(){formobj=document.getElementById("pollform");document.getElementById("quickpoll").disabled="disabled";submitstring="ajax_poll=1";for(i=0;i<formobj.elements.length;i++){var a=formobj.elements[i];if(a.name&&!a.disabled){if(a.type!="checkbox"&&a.type!="radio"){submitstring+="&"+a.name+"="+bmb_ajax_encode(a.value)}else{if(a.checked==1){submitstring+="&"+a.name+"="+bmb_ajax_encode(a.value)}}}}document.body.style.cursor="wait";ajaxtmp.filename=formobj.filename.value;makeRequest("vote.php",submitstring,bmb_ajax_makepoll_ajax,"POST")}function bmb_ajax_makepoll_ajax(){if(http_request.readyState==4){if(http_request.status==200&&http_request.responseText=="1"){ajaxtmp.times=ajaxtmp.times+1;makeRequest("topic.php?display_poll=1&rnd="+ajaxtmp.times+"&ajax_display=1&pid="+ajaxtmp.filename+"&filename="+ajaxtmp.filename,null,bmb_ajax_makepoll_reply_back,"GET")}else{document.getElementById("quickpoll").disabled="";document.body.style.cursor="";display_error_box(http_request.responseText)}}}function bmb_ajax_makepoll_reply_back(){if(http_request.readyState==4){if(http_request.status==200){result=http_request.responseText;document.getElementById("poll_content").innerHTML=result}else{document.getElementById("quickpoll").disabled="";display_error_box(http_request.responseText)}}document.body.style.cursor=""}function display_score_box(d,b,a,c){ajaxtmp.score_page=d;ajaxtmp.score_tid=a;document.body.style.cursor="wait";makeRequest("misc.php?p=byms&ajax_request=1&page="+d+"&forumid="+b+"&filename="+a+"&article="+c,"",display_score_box_back,"GET")}function display_score_box_back(){if(http_request.readyState==4){if(http_request.status==200){result=http_request.responseText;$("#ajax_scores_detail").html(result);$("#ajax_scores_div").modal("show");document.getElementById("quickbym").disabled=""}else{display_error_box(http_request.responseText)}}document.body.style.cursor=""}function submit_score_box(){document.body.style.cursor="wait";document.getElementById("quickbym").disabled="disabled";formobj=document.getElementById("bymform");submitstring="ajax_request=1";for(i=0;i<formobj.elements.length;i++){var a=formobj.elements[i];if(a.name&&!a.disabled&&a.type!="select"){if(a.type!="checkbox"&&a.type!="radio"){submitstring+="&"+a.name+"="+bmb_ajax_encode(a.value)}else{if(a.checked==1){submitstring+="&"+a.name+"="+bmb_ajax_encode(a.value)}}}}makeRequest("misc.php?p=byms",submitstring,submit_score_box_back,"POST")}function submit_score_box_back(){if(http_request.readyState==4){if(http_request.status==200){result=http_request.responseText;$("#ajax_scores_div").modal("hide");ajaxtmp.nopagebarchange=1;bmb_ajax_displaypost(ajaxtmp.score_page,ajaxtmp.score_tid)}else{$("#ajax_scores_div").modal("hide");display_error_box(http_request.responseText)}}document.body.style.cursor=""}function show_msg_content(a){if(document.getElementById("BMF_message_content_"+a).style.display=="block"){close_show_msg_content(a)}else{ajaxtmp.show_msg_id=a;makeRequest("messenger.php?job=ajax&msg="+a,null,handle_show_msg_content,"GET")}}function handle_show_msg_content(){if(http_request.readyState==4){if(http_request.status==200){var a=http_request.responseText;document.getElementById("BMF_message_content_"+ajaxtmp.show_msg_id).innerHTML=a;document.getElementById("BMF_message_content_"+ajaxtmp.show_msg_id).style.visibility="";document.getElementById("BMF_message_content_"+ajaxtmp.show_msg_id).style.display="block";document.getElementById("BMF_message_toolbar_"+ajaxtmp.show_msg_id).style.visibility="";document.getElementById("BMF_message_toolbar_"+ajaxtmp.show_msg_id).style.display="block"}else{display_error_box(http_request.responseText)}}}function close_show_msg_content(a){document.getElementById("BMF_message_content_"+a).style.visibility="hidden";document.getElementById("BMF_message_content_"+a).style.display="none";document.getElementById("BMF_message_toolbar_"+a).style.visibility="hidden";document.getElementById("BMF_message_toolbar_"+a).style.display="none"}function digg_thread(b,a){ajaxtmp.diggorg=document.getElementById("diggs").innerHTML;document.getElementById("diggs").innerHTML="<img src='"+a+"/digg/loading.gif' border='0' alt='' title='' />";makeRequest("misc.php?p=digg&action=digg&filename="+b,null,handle_digg_thread,"GET")}function handle_digg_thread(){if(http_request.readyState==4){document.getElementById("diggs").innerHTML=ajaxtmp.diggorg;if(http_request.status==200){document.getElementById("diggs-strong").innerHTML=http_request.responseText}else{display_error_box(http_request.responseText)}}}function bmb_ajax_encode(a){a=encodeURIComponent(a);if(navigator.product=="Gecko"){a=a.replace(/%0A/g,"%0D%0A")}return a}function display_error_box(a){document.getElementById("ajax_error_detail").innerHTML=a;$("#ajax_information").fadeIn();$("html,body").animate({scrollTop:$("#ajax_information").offset()},1000)}function checkbatch(b,a){o_batem=document.getElementById(a);if(!o_batem.checked){$(o_batem).attr("checked",true);$(b).attr("class","bottom_button_batch")}else{$(o_batem).attr("checked",false);$(b).attr("class","batquoteselect bottom_button")}}function init_checkMessage(b,a,c){if(b>0){$(document).attr("title","("+b+") "+$(document).attr("fulltitle"));$("#head_totalnewmess").html("("+b+")")}else{$(document).attr("title",$(document).attr("fulltitle"));$("#head_totalnewmess").html("")}if(a!=-1){$("#head_newpm").html(a>0?"("+a+")":"");$("#head_newnotify").html(c>0?"("+c+")":"")}setTimeout("checkmessage();",30000)}function checkmessage(){ajaxtmp.times=ajaxtmp.times+1;makeRequest("plugins.php?p=ajax&act=checkmessages&rnd="+ajaxtmp.times,null,handle_checkmessage,"GET")}function handle_checkmessage(){if(http_request.readyState==4){if(http_request.status==200){data=eval("("+http_request.responseText+")");if(data.succ){totalMessage=data.notify+data.pm;init_checkMessage(totalMessage,data.pm,data.notify)}}else{setTimeout("checkmessage();",60000)}}}vCard=function(e){var b=new Array();function a(g,f,h){if(!f&&!h){return}if(e("div[id='vcard_"+f+"_"+h+"']").html()){d(g,f,h)}else{ajaxtmp.times=ajaxtmp.times+1;makeRequest("plugins.php?p=ajax&act=vcard&uid="+f+"&username="+bmb_ajax_encode(h)+"&rnd="+ajaxtmp.times,null,function(){if(http_request.readyState==4&&http_request.status==200){e(http_request.responseText).appendTo("#appendArea");d(g,f,h)}},"GET")}}function d(g,f,h){sourcepos=e(g).position();sourceoffset=e(g).offset();cardpost=e(g).attr("cardpos")?1:0;offtop=sourcepos.top;offleft=sourcepos.left;if(!cardpost){e("div[id='vcard_"+f+"_"+h+"']").css({top:sourcepos.top,left:sourcepos.left+e(g).width()+20})}else{if(sourcepos.top+e("div[id='vcard_"+f+"_"+h+"']").height()>e(window).height()+e(window).scrollTop()){offtop=sourcepos.top-e("div[id='vcard_"+f+"_"+h+"']").height()-10}else{offtop=sourcepos.top+e(g).height()+10}if(sourcepos.left+e("div[id='vcard_"+f+"_"+h+"']").width()>e(window).width()-10){offleft=sourcepos.left-e("div[id='vcard_"+f+"_"+h+"']").width()+e(g).width()}e("div[id='vcard_"+f+"_"+h+"']").css({top:offtop,left:offleft})}clearTimeout(b[f+"_"+h]);b[f+"_"+h]=null;e(".vcard").each(function(){vuid=e(this).attr("uid")!==undefined?e(this).attr("uid"):"";vusername=e(this).attr("username")!==undefined?e(this).attr("username"):"";cardId="vcard_"+f+"_"+h;if(e(this).attr("id")!=cardId){c(vuid,vusername)}});c(f,h,1)}function c(g,h,f){if(f){e("div[id='vcard_"+g+"_"+h+"']").fadeIn("fast")}else{e("div[id='vcard_"+g+"_"+h+"']").fadeOut("fast")}}e(".userinfoarea").live({mouseenter:function(){a(e(this),e(this).attr("uid")!==undefined?e(this).attr("uid"):"",e(this).attr("username")!==undefined?e(this).attr("username"):"")}});e(".vcard,.userinfoarea").live({mouseenter:function(f){uid=e(this).attr("uid")!==undefined?e(this).attr("uid"):"";username=e(this).attr("username")!==undefined?e(this).attr("username"):"";clearTimeout(b[uid+"_"+username]);b[uid+"_"+username]=null},mouseleave:function(f){uid=e(this).attr("uid")!==undefined?e(this).attr("uid"):"";username=e(this).attr("username")!==undefined?e(this).attr("username"):"";if(!b[uid+"_"+username]){b[uid+"_"+username]=setTimeout(function(h,g){return function(){c(h,g)}}(uid,username),400)}}})};GlobalCard=new vCard(jQuery);